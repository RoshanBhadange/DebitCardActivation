pipeline {
    agent any
    environment {
            SPARK_HOME = 'D:\\gnral_soft\\spark3'
            HADOOP_HOME = 'D:\\gnral_soft\\hadoop-3.2.0'
            HADOOP_CONF_DIR = 'D:\\gnral_soft\\spark3\\conf'
        }
    tools {
            maven 'Maven-3.6.3'
        }
    stages {
    stage('Build') {
        steps {
            script {
                bat 'start /B mvn clean install'
            }
        }
    }
    stage('Test') {
        steps {
            echo 'Unit test'
        }
    }
    stage ('Run Script') {
        steps {
            script {
                echo 'Run spark-submit command'
                def sparkSubmitCmd = "${SPARK_HOME}\\bin\\spark-submit --class DebitCardActivation --master yarn --deploy-mode client --conf spark.yarn.submit.waitAppCompletion=false --conf spark.executor.extraJavaOptions=-Dhdp.version=3.2.0 C:\\Users\\91866\\IdeaProjects\\DebitCardActivation1\\target\\DebitCardActivation.jar"
                bat sparkSubmitCmd
            }

        }

    }
}
post {
        success {
            echo 'Pipeline succeeded!'
        }
        failure {
            echo 'Pipeline failed!'
        }
    }

}